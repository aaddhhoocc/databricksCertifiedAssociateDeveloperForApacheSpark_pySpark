{"version":"NotebookV1","origId":1575837098434162,"name":"06 Cleansing Data using Spark UDFs","language":"python","commands":[{"version":"CommandV1","origId":1575837098434163,"guid":"7c736ebf-86d6-41cc-80c9-1d04f713edea","subtype":"command","commandType":"auto","position":0.5,"command":"import pandas as pd","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858062701,"submitTime":1641858060708,"finishTime":1641858063050,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"0958dd52-2c22-4965-873a-4c4f8b8e8312"},{"version":"CommandV1","origId":1575837098434164,"guid":"ac89b1cb-c718-4354-a73e-58962972ed16","subtype":"command","commandType":"auto","position":1.0,"command":"courses = {'course_id': ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],\n           'course_name': ['Mastering SQL', 'Streaming Pipelines - Python', 'Head First Python',\n                           'Designing Data-Intensive Applications', 'Distributed Systems', 'Database Internals',\n                           'Art of Immutable Architecture', 'Graph Databases', 'Building MicroServices',\n                           'Kubernetes Patterns'],\n           'course_author': ['Mike Jack', 'Bob Davis', 'Elvis Presley', 'Martin Kleppmann', 'Sukumar Ghosh',\n                             'Alex Petrov',\n                             'Michael L. Perry', 'Ian Robinson', 'Sam Newman', 'Rolan Hub'],\n           'course_status': ['   published   ', '   inactive   ', '\\\\N', 'published  ', '\\\\N', '   inactive',\n                             'published   ', '\\\\N', '  inactive ', 'published   '],\n           'course_published_dt': ['2020-07-08', '2020-03-10', '\\\\N', '2021-02-27', '\\\\N', '2021-05-14',\n                                   '2021-04-18', '\\\\N',\n                                   '2020-12-15', '2021-07-11']}\n\ncourses_df = spark.createDataFrame(pd.DataFrame(courses))","commandVersion":26,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"courses_df","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"course_id","nullable":true,"type":"string"},{"metadata":{},"name":"course_name","nullable":true,"type":"string"},{"metadata":{},"name":"course_author","nullable":true,"type":"string"},{"metadata":{},"name":"course_status","nullable":true,"type":"string"},{"metadata":{},"name":"course_published_dt","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858063055,"submitTime":1641858060749,"finishTime":1641858063315,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"cf672104-60b8-491e-ad2b-951b4382baf9"},{"version":"CommandV1","origId":1575837098434165,"guid":"371187c7-6fa7-45a1-8fea-f0e1a5f6cf64","subtype":"command","commandType":"auto","position":2.0,"command":"users = {'user_id': ['1001', '1002', '1003', '1004', '1005', '1006'],\n         'user_name': ['BenJohnson   ', '  Halley Battles ', '  Laura Anderson  ', '  Rolanda Garza ',\n                       'Angela Fox  ', 'Kerl Goldinger '],\n         'user_email': ['benjohn@gmail.com', '\\\\N', '\\\\N', 'garza.roland@gmail.com', 'nshaiary@aol.com',\n                        'k.gold@live.com1'],\n         'user_gender': ['Male', 'Male', 'Female', 'Male', 'Female', 'Male']}\n\nusers_df = spark.createDataFrame(pd.DataFrame(users))","commandVersion":9,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"users_df","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"user_id","nullable":true,"type":"string"},{"metadata":{},"name":"user_name","nullable":true,"type":"string"},{"metadata":{},"name":"user_email","nullable":true,"type":"string"},{"metadata":{},"name":"user_gender","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858063319,"submitTime":1641858060784,"finishTime":1641858063384,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"fadb4ac5-abd7-4f1b-b723-843e87a4c868"},{"version":"CommandV1","origId":1575837098434166,"guid":"c9d2dab6-884d-4f91-ac3e-ed22e5cebb2c","subtype":"command","commandType":"auto","position":3.0,"command":"course_enrolments = {'course_id': ['3', '5', '8', '5', '6', '8', '7', '3'],\n                     'user_id': ['1001', '1001', '1003', '1003', '1005', '1006', '1001', '1001'],\n                     'enrollment_id': ['9010', '9020', '9030', '9040', '9050', '9060', '9070', '9080'],\n                     'grade': ['A', '\\\\N', 'A', '\\\\N', 'B', 'C', '\\\\N', 'A'],\n                     'department': ['AI  ', 'ML', '  CS', '  DS', '  AI', 'ML', '  CS', 'DS  ']}\n\ncourse_enrolments_df = spark.createDataFrame(pd.DataFrame(course_enrolments))","commandVersion":11,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"course_enrolments_df","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"course_id","nullable":true,"type":"string"},{"metadata":{},"name":"user_id","nullable":true,"type":"string"},{"metadata":{},"name":"enrollment_id","nullable":true,"type":"string"},{"metadata":{},"name":"grade","nullable":true,"type":"string"},{"metadata":{},"name":"department","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858063389,"submitTime":1641858060822,"finishTime":1641858063446,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"651c47c4-7a8c-4f60-b15d-c851dea6959a"},{"version":"CommandV1","origId":1575837098434167,"guid":"bcdf8310-7bb8-419b-90f7-5b80c199056d","subtype":"command","commandType":"auto","position":4.0,"command":"def data_cleanse(c):\n    return c.strip() if c.strip() != '\\\\N' else None","commandVersion":69,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858063452,"submitTime":1641858060860,"finishTime":1641858063465,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"a13ba6fc-d137-4a3e-986a-0224c180c9ea"},{"version":"CommandV1","origId":1575837098434168,"guid":"1b4ae7de-6853-4ef9-b572-80f53dd40fe6","subtype":"command","commandType":"auto","position":5.0,"command":"data_cleanse = spark.udf.register('data_cleanse', data_cleanse)","commandVersion":15,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858063469,"submitTime":1641858060898,"finishTime":1641858063522,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"5d3af707-8a27-4d21-a84e-2fae14ad0a19"},{"version":"CommandV1","origId":1575837098434169,"guid":"9b6b9dfe-dc35-4ccb-8ec3-bcfdd79eff0a","subtype":"command","commandType":"auto","position":6.0,"command":"courses_df.show()","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+---------+--------------------+----------------+---------------+-------------------+\n|course_id|         course_name|   course_author|  course_status|course_published_dt|\n+---------+--------------------+----------------+---------------+-------------------+\n|        1|       Mastering SQL|       Mike Jack|   published   |         2020-07-08|\n|        2|Streaming Pipelin...|       Bob Davis|    inactive   |         2020-03-10|\n|        3|   Head First Python|   Elvis Presley|             \\N|                 \\N|\n|        4|Designing Data-In...|Martin Kleppmann|    published  |         2021-02-27|\n|        5| Distributed Systems|   Sukumar Ghosh|             \\N|                 \\N|\n|        6|  Database Internals|     Alex Petrov|       inactive|         2021-05-14|\n|        7|Art of Immutable ...|Michael L. Perry|   published   |         2021-04-18|\n|        8|     Graph Databases|    Ian Robinson|             \\N|                 \\N|\n|        9|Building MicroSer...|      Sam Newman|      inactive |         2020-12-15|\n|       10| Kubernetes Patterns|       Rolan Hub|   published   |         2021-07-11|\n+---------+--------------------+----------------+---------------+-------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858063527,"submitTime":1641858060937,"finishTime":1641858064172,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"715479f4-0841-4ee0-9edb-e8f089685743"},{"version":"CommandV1","origId":1575837098434170,"guid":"f812a4ec-5318-45eb-a860-81260e42ccfd","subtype":"command","commandType":"auto","position":6.5,"command":"from pyspark.sql.functions import col","commandVersion":7,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858089994,"submitTime":1641858089975,"finishTime":1641858090009,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"ec6f3ede-5537-43a5-90de-5ab790d43a05"},{"version":"CommandV1","origId":1575837098434171,"guid":"bc0dc474-aec9-4c6c-af45-3a983c6002a5","subtype":"command","commandType":"auto","position":7.0,"command":"courses_df.select(\n    data_cleanse(col('course_id')).alias('course_id'),\n    data_cleanse(col('course_status').alias('course_status'))\n).show()","commandVersion":43,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+---------+----------------------------------------------+\n|course_id|data_cleanse(course_status AS `course_status`)|\n+---------+----------------------------------------------+\n|        1|                                     published|\n|        2|                                      inactive|\n|        3|                                          null|\n|        4|                                     published|\n|        5|                                          null|\n|        6|                                      inactive|\n|        7|                                     published|\n|        8|                                          null|\n|        9|                                      inactive|\n|       10|                                     published|\n+---------+----------------------------------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858091437,"submitTime":1641858091409,"finishTime":1641858092370,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"86d25120-f84d-4303-981a-053cad669ba5"},{"version":"CommandV1","origId":1575837098434172,"guid":"12dc558a-75cc-47b8-8bca-03ff026d38d8","subtype":"command","commandType":"auto","position":8.0,"command":"courses_df.createOrReplaceTempView('courses')","commandVersion":8,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858109425,"submitTime":1641858109400,"finishTime":1641858109458,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"cffe3fd1-e8f6-4472-84b1-45d58eddbede"},{"version":"CommandV1","origId":1575837098434173,"guid":"8061f242-8256-452e-9368-73a727e905da","subtype":"command","commandType":"auto","position":9.0,"command":"spark.sql('''\n    SELECT course_id, data_cleanse(course_status) AS course_status\n    FROM courses\n'''). \\\n    show()","commandVersion":23,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+---------+-------------+\n|course_id|course_status|\n+---------+-------------+\n|        1|    published|\n|        2|     inactive|\n|        3|         null|\n|        4|    published|\n|        5|         null|\n|        6|     inactive|\n|        7|    published|\n|        8|         null|\n|        9|     inactive|\n|       10|    published|\n+---------+-------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641858166428,"submitTime":1641858166406,"finishTime":1641858166634,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"cefee4db-ef5d-4415-af25-3c2a0b4a21d2"},{"version":"CommandV1","origId":1575837098434174,"guid":"8dcc76fc-efd7-4876-a9ef-fa4ff3eb4ab5","subtype":"command","commandType":"auto","position":10.0,"command":"","commandVersion":0,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"a8c4f578-8432-4ab3-bba1-d0a5adc3f1d0"}],"dashboards":[],"guid":"96eecff7-cfd2-4d5f-be69-15f070f0ec68","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4}}
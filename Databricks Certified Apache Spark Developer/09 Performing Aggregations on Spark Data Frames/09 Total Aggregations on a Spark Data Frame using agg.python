{"version":"NotebookV1","origId":1575837098435640,"name":"09 Total Aggregations on a Spark Data Frame using agg","language":"python","commands":[{"version":"CommandV1","origId":840394436335143,"guid":"6836886e-74a1-4047-9fc2-76e8557ad782","subtype":"command","commandType":"auto","position":3.859375,"command":"help(order_items.agg)","commandVersion":4,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Help on method agg in module pyspark.sql.dataframe:\n\nagg(*exprs) method of pyspark.sql.dataframe.DataFrame instance\n    Aggregate on the entire :class:`DataFrame` without groups\n    (shorthand for ``df.groupBy().agg()``).\n    \n    .. versionadded:: 1.3.0\n    \n    Examples\n    --------\n    &gt;&gt;&gt; df.agg({&#34;age&#34;: &#34;max&#34;}).collect()\n    [Row(max(age)=5)]\n    &gt;&gt;&gt; from pyspark.sql import functions as F\n    &gt;&gt;&gt; df.agg(F.min(df.age)).collect()\n    [Row(min(age)=2)]\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073219763,"submitTime":1642073219714,"finishTime":1642073219783,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"7b1ff17d-9230-46a9-9b6c-1d06ecc18542"},{"version":"CommandV1","origId":840394436335144,"guid":"2b4d1409-532a-446d-aefb-04636ac1d164","subtype":"command","commandType":"auto","position":3.8671875,"command":"help(order_items.groupBy('order_item_order_id').agg)","commandVersion":9,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Help on method agg in module pyspark.sql.group:\n\nagg(*exprs) method of pyspark.sql.group.GroupedData instance\n    Compute aggregates and returns the result as a :class:`DataFrame`.\n    \n    The available aggregate functions can be:\n    \n    1. built-in aggregation functions, such as `avg`, `max`, `min`, `sum`, `count`\n    \n    2. group aggregate pandas UDFs, created with :func:`pyspark.sql.functions.pandas_udf`\n    \n       .. note:: There is no partial aggregation with group aggregate UDFs, i.e.,\n           a full shuffle is required. Also, all the data of a group will be loaded into\n           memory, so the user should be aware of the potential OOM risk if data is skewed\n           and certain groups are too large to fit in memory.\n    \n       .. seealso:: :func:`pyspark.sql.functions.pandas_udf`\n    \n    If ``exprs`` is a single :class:`dict` mapping from string to string, then the key\n    is the column to perform aggregation on, and the value is the aggregate function.\n    \n    Alternatively, ``exprs`` can also be a list of aggregate :class:`Column` expressions.\n    \n    .. versionadded:: 1.3.0\n    \n    Parameters\n    ----------\n    exprs : dict\n        a dict mapping from column name (string) to aggregate functions (string),\n        or a list of :class:`Column`.\n    \n    Notes\n    -----\n    Built-in aggregation functions and group aggregate pandas UDFs cannot be mixed\n    in a single call to this function.\n    \n    Examples\n    --------\n    &gt;&gt;&gt; gdf = df.groupBy(df.name)\n    &gt;&gt;&gt; sorted(gdf.agg({&#34;*&#34;: &#34;count&#34;}).collect())\n    [Row(name=&#39;Alice&#39;, count(1)=1), Row(name=&#39;Bob&#39;, count(1)=1)]\n    \n    &gt;&gt;&gt; from pyspark.sql import functions as F\n    &gt;&gt;&gt; sorted(gdf.agg(F.min(df.age)).collect())\n    [Row(name=&#39;Alice&#39;, min(age)=2), Row(name=&#39;Bob&#39;, min(age)=5)]\n    \n    &gt;&gt;&gt; from pyspark.sql.functions import pandas_udf, PandasUDFType\n    &gt;&gt;&gt; @pandas_udf(&#39;int&#39;, PandasUDFType.GROUPED_AGG)  # doctest: +SKIP\n    ... def min_udf(v):\n    ...     return v.min()\n    &gt;&gt;&gt; sorted(gdf.agg(min_udf(df.age)).collect())  # doctest: +SKIP\n    [Row(name=&#39;Alice&#39;, min_udf(age)=2), Row(name=&#39;Bob&#39;, min_udf(age)=5)]\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073251998,"submitTime":1642073251961,"finishTime":1642073252032,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"108bd97d-40d8-45bc-919a-30106938d9df"},{"version":"CommandV1","origId":840394436335145,"guid":"5f182b89-62f7-474c-b269-db86a760ee22","subtype":"command","commandType":"auto","position":0.5,"command":"%md\n\nTo perform total aggregations we can also leverage `agg` function.","commandVersion":39,"state":"finished","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"8332f685-c33b-4975-94bf-1b93c45593f3"},{"version":"CommandV1","origId":840394436335146,"guid":"d0909b03-c0c9-4a59-9f30-351786572ac1","subtype":"command","commandType":"auto","position":11.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"350985d8-33d1-4449-9b59-0cc6f9e4174a"},{"version":"CommandV1","origId":1575837098435641,"guid":"969e211b-6d24-4a8a-bc17-538285253728","subtype":"command","commandType":"auto","position":1.0,"command":"order_items = spark.read.json('/public/retail_db_json/order_items')","commandVersion":14,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"order_items","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"order_item_id","nullable":true,"type":"long"},{"metadata":{},"name":"order_item_order_id","nullable":true,"type":"long"},{"metadata":{},"name":"order_item_product_id","nullable":true,"type":"long"},{"metadata":{},"name":"order_item_product_price","nullable":true,"type":"double"},{"metadata":{},"name":"order_item_quantity","nullable":true,"type":"long"},{"metadata":{},"name":"order_item_subtotal","nullable":true,"type":"double"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073161778,"submitTime":1642073160452,"finishTime":1642073163330,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"b8a7ed41-932a-4e29-8381-de8bffaad82c"},{"version":"CommandV1","origId":1575837098435642,"guid":"36ae337e-4605-4888-8e3a-994d6b18cc42","subtype":"command","commandType":"auto","position":2.0,"command":"order_items.dtypes","commandVersion":5,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Out[2]: [(&#39;order_item_id&#39;, &#39;bigint&#39;),\n (&#39;order_item_order_id&#39;, &#39;bigint&#39;),\n (&#39;order_item_product_id&#39;, &#39;bigint&#39;),\n (&#39;order_item_product_price&#39;, &#39;double&#39;),\n (&#39;order_item_quantity&#39;, &#39;bigint&#39;),\n (&#39;order_item_subtotal&#39;, &#39;double&#39;)]</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073164069,"submitTime":1642073164019,"finishTime":1642073164092,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"c427ef7b-7b98-474b-840b-8e8f7e88201e"},{"version":"CommandV1","origId":1575837098435643,"guid":"8d8e7c7a-a35f-4c49-8ed2-347562d4d426","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n\n  * Get revenue using `order_item_subtotal` for a given `order_item_order_id` (eg: 2)","commandVersion":32,"state":"finished","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"dc5c0869-a7e5-4452-8d18-9e52a9ec991c"},{"version":"CommandV1","origId":1575837098435644,"guid":"84e22cd9-3ceb-4ccd-9806-fab2889e8fc1","subtype":"command","commandType":"auto","position":3.5,"command":"order_items.filter('order_item_order_id = 2')","commandVersion":10,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Out[3]: DataFrame[order_item_id: bigint, order_item_order_id: bigint, order_item_product_id: bigint, order_item_product_price: double, order_item_quantity: bigint, order_item_subtotal: double]</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073166336,"submitTime":1642073166287,"finishTime":1642073166399,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"10627606-c3c0-48b4-9d8f-7e7e276d29b7"},{"version":"CommandV1","origId":1575837098435645,"guid":"1f979c32-5731-40d5-8a87-d72717637ade","subtype":"command","commandType":"auto","position":3.75,"command":"order_items.filter('order_item_order_id = 2').show()","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+-------------+-------------------+---------------------+------------------------+-------------------+-------------------+\n|order_item_id|order_item_order_id|order_item_product_id|order_item_product_price|order_item_quantity|order_item_subtotal|\n+-------------+-------------------+---------------------+------------------------+-------------------+-------------------+\n|            2|                  2|                 1073|                  199.99|                  1|             199.99|\n|            3|                  2|                  502|                    50.0|                  5|              250.0|\n|            4|                  2|                  403|                  129.99|                  1|             129.99|\n+-------------+-------------------+---------------------+------------------------+-------------------+-------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073168377,"submitTime":1642073168339,"finishTime":1642073169907,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"b16bab77-bc21-4152-b2c9-74b0a490d007"},{"version":"CommandV1","origId":1575837098435646,"guid":"9f9450a3-d778-42b9-a2d6-f6cbe04fec09","subtype":"command","commandType":"auto","position":3.8125,"command":"from pyspark.sql.functions import sum","commandVersion":8,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073170372,"submitTime":1642073170329,"finishTime":1642073170389,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"be8abbdc-0d94-4612-a05f-c7b0a092defe"},{"version":"CommandV1","origId":1575837098435647,"guid":"f3574547-56e1-4809-abf5-f7d3f9672c13","subtype":"command","commandType":"auto","position":3.84375,"command":"help(sum)","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Help on function sum in module pyspark.sql.functions:\n\nsum(col)\n    Aggregate function: returns the sum of all values in the expression.\n    \n    .. versionadded:: 1.3\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073171556,"submitTime":1642073171514,"finishTime":1642073171583,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"08652ef6-78fd-40bc-915b-57100b97d654"},{"version":"CommandV1","origId":1575837098435648,"guid":"0aa7e610-5a7a-41a3-bc45-5cb7d6388f5e","subtype":"command","commandType":"auto","position":3.875,"command":"order_items.filter('order_item_order_id = 2').agg(sum('order_item_subtotal')).show()","commandVersion":19,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+------------------------+\n|sum(order_item_subtotal)|\n+------------------------+\n|                  579.98|\n+------------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073338873,"submitTime":1642073338798,"finishTime":1642073339783,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"280ca985-b3e2-43aa-989d-b2ac7ede1171"},{"version":"CommandV1","origId":1575837098435649,"guid":"c657fe89-0b6f-4ed7-9272-c52db1a86558","subtype":"command","commandType":"auto","position":3.9375,"command":"order_items.filter('order_item_order_id = 2').agg(sum('order_item_subtotal').alias('order_revenue')).show()","commandVersion":10,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+-------------+\n|order_revenue|\n+-------------+\n|       579.98|\n+-------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073344711,"submitTime":1642073344670,"finishTime":1642073345513,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"3b103989-b63d-417a-8307-893d6d4c7230"},{"version":"CommandV1","origId":1575837098435650,"guid":"6de0c015-17f8-4ca3-a874-0a88fe617f1d","subtype":"command","commandType":"auto","position":4.0,"command":"%md\n\n* Get number of items, total quantity as well as revenue for a given order item order id (eg: 2)\n  * Number of items can be computed using `count` on `order_item_quantity`.\n  * Total quantity can be computed using `sum` on `order_item_quantity`.\n  * Total Revenue can be computed using `sum` on `order_item_subtotal`.","commandVersion":74,"state":"finished","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"22e6921a-3c31-4e84-8db3-64c45061f210"},{"version":"CommandV1","origId":1575837098435651,"guid":"89fb0e07-4ec5-44a3-8f47-9176f966dd72","subtype":"command","commandType":"auto","position":6.5,"command":"from pyspark.sql.functions import count","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073353322,"submitTime":1642073353283,"finishTime":1642073353339,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"41b8a06e-3ce1-4ca5-be4d-e042a2f64c01"},{"version":"CommandV1","origId":1575837098435652,"guid":"da7baac1-101e-409e-b248-3d2ba0af31e6","subtype":"command","commandType":"auto","position":7.75,"command":"order_items. \\\n    filter('order_item_order_id = 2'). \\\n    show()","commandVersion":4,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+-------------+-------------------+---------------------+------------------------+-------------------+-------------------+\n|order_item_id|order_item_order_id|order_item_product_id|order_item_product_price|order_item_quantity|order_item_subtotal|\n+-------------+-------------------+---------------------+------------------------+-------------------+-------------------+\n|            2|                  2|                 1073|                  199.99|                  1|             199.99|\n|            3|                  2|                  502|                    50.0|                  5|              250.0|\n|            4|                  2|                  403|                  129.99|                  1|             129.99|\n+-------------+-------------------+---------------------+------------------------+-------------------+-------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073354464,"submitTime":1642073354421,"finishTime":1642073355450,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"877f7677-ff6d-40c3-93e2-17b8245c3f63"},{"version":"CommandV1","origId":1575837098435653,"guid":"dfbe8b43-2c19-4c81-be87-e0f9d8228ccf","subtype":"command","commandType":"auto","position":9.0,"command":"order_items. \\\n    filter('order_item_order_id = 2'). \\\n    agg(\n        count('order_item_quantity').alias('order_item_count'),\n        sum('order_item_quantity').alias('order_quantity'),\n        sum('order_item_subtotal').alias('order_revenue')\n    ). \\\n    show()","commandVersion":49,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+----------------+--------------+-------------+\n|order_item_count|order_quantity|order_revenue|\n+----------------+--------------+-------------+\n|               3|             7|       579.98|\n+----------------+--------------+-------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073364656,"submitTime":1642073364617,"finishTime":1642073365645,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"49f99c8c-9245-4b23-8e47-62f2ea5b66db"},{"version":"CommandV1","origId":1575837098435654,"guid":"60e646de-d508-4056-9df9-67a34a8b7931","subtype":"command","commandType":"auto","position":10.0,"command":"# We can only perform one aggregation per one column using this approach\norder_items. \\\n    filter('order_item_order_id = 2'). \\\n    agg(\n        {'order_item_quantity': 'count', 'order_item_subtotal': 'sum'}\n    ). \\\n    toDF('order_item_count', 'order_revenue'). \\\n    show()","commandVersion":62,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+----------------+-------------+\n|order_item_count|order_revenue|\n+----------------+-------------+\n|          579.98|            3|\n+----------------+-------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1642073577466,"submitTime":1642073577418,"finishTime":1642073578226,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"e28ece26-0ca2-44f5-bea1-b019ff63b37d"}],"dashboards":[],"guid":"e52462b4-2f23-4596-81b2-f3edecce0565","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4}}
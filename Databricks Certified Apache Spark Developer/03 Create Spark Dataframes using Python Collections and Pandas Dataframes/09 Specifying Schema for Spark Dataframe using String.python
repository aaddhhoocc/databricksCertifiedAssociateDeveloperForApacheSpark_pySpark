{"version":"NotebookV1","origId":1575837098435684,"name":"09 Specifying Schema for Spark Dataframe using String","language":"python","commands":[{"version":"CommandV1","origId":1575837098435685,"guid":"2fcde616-291a-4e8c-9246-fb7b6b7ef562","subtype":"command","commandType":"auto","position":1.0,"command":"import datetime\nusers = [(1,\n  'Corrie',\n  'Van den Oord',\n  'cvandenoord0@etsy.com',\n  True,\n  1000.55,\n  datetime.date(2021, 1, 15),\n  datetime.datetime(2021, 2, 10, 1, 15)),\n (2,\n  'Nikolaus',\n  'Brewitt',\n  'nbrewitt1@dailymail.co.uk',\n  True,\n  900.0,\n  datetime.date(2021, 2, 14),\n  datetime.datetime(2021, 2, 18, 3, 33)),\n (3,\n  'Orelie',\n  'Penney',\n  'openney2@vistaprint.com',\n  True,\n  850.55,\n  datetime.date(2021, 1, 21),\n  datetime.datetime(2021, 3, 15, 15, 16, 55)),\n (4,\n  'Ashby',\n  'Maddocks',\n  'amaddocks3@home.pl',\n  False,\n  None,\n  None,\n  datetime.datetime(2021, 4, 10, 17, 45, 30)),\n (5,\n  'Kurt',\n  'Rome',\n  'krome4@shutterfly.com',\n  False,\n  None,\n  None,\n  datetime.datetime(2021, 4, 2, 0, 55, 18))]","commandVersion":282,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1640448138419,"submitTime":1640448138390,"finishTime":1640448138453,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"14b6a601-2c96-46ed-a857-cb5a9a477a4a"},{"version":"CommandV1","origId":1575837098435686,"guid":"ba12efd7-3f9e-4dea-9a6c-43b1f42a48a2","subtype":"command","commandType":"auto","position":1.5,"command":"users_schema = '''\n    id INT,\n    first_name STRING,\n    last_name STRING,\n    email STRING,\n    is_customer BOOLEAN,\n    amount_paid FLOAT,\n    customer_from DATE,\n    last_updated_ts TIMESTAMP\n'''","commandVersion":51,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1640448398611,"submitTime":1640448398604,"finishTime":1640448398630,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"423e274c-0aa2-4102-a3c1-c87dc16002c3"},{"version":"CommandV1","origId":1575837098435687,"guid":"638c9bd2-abbd-4624-bed8-d5936c7d57c1","subtype":"command","commandType":"auto","position":1.75,"command":"help(spark.createDataFrame)","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Help on method createDataFrame in module pyspark.sql.session:\n\ncreateDataFrame(data, schema=None, samplingRatio=None, verifySchema=True) method of pyspark.sql.session.SparkSession instance\n    Creates a :class:`DataFrame` from an :class:`RDD`, a list or a :class:`pandas.DataFrame`.\n    \n    When ``schema`` is a list of column names, the type of each column\n    will be inferred from ``data``.\n    \n    When ``schema`` is ``None``, it will try to infer the schema (column names and types)\n    from ``data``, which should be an RDD of either :class:`Row`,\n    :class:`namedtuple`, or :class:`dict`.\n    \n    When ``schema`` is :class:`pyspark.sql.types.DataType` or a datatype string, it must match\n    the real data, or an exception will be thrown at runtime. If the given schema is not\n    :class:`pyspark.sql.types.StructType`, it will be wrapped into a\n    :class:`pyspark.sql.types.StructType` as its only field, and the field name will be &#34;value&#34;.\n    Each record will also be wrapped into a tuple, which can be converted to row later.\n    \n    If schema inference is needed, ``samplingRatio`` is used to determined the ratio of\n    rows used for schema inference. The first row will be used if ``samplingRatio`` is ``None``.\n    \n    .. versionadded:: 2.0.0\n    \n    .. versionchanged:: 2.1.0\n       Added verifySchema.\n    \n    Parameters\n    ----------\n    data : :class:`RDD` or iterable\n        an RDD of any kind of SQL data representation (:class:`Row`,\n        :class:`tuple`, ``int``, ``boolean``, etc.), or :class:`list`, or\n        :class:`pandas.DataFrame`.\n    schema : :class:`pyspark.sql.types.DataType`, str or list, optional\n        a :class:`pyspark.sql.types.DataType` or a datatype string or a list of\n        column names, default is None.  The data type string format equals to\n        :class:`pyspark.sql.types.DataType.simpleString`, except that top level struct type can\n        omit the ``struct&lt;&gt;`` and atomic types use ``typeName()`` as their format, e.g. use\n        ``byte`` instead of ``tinyint`` for :class:`pyspark.sql.types.ByteType`.\n        We can also use ``int`` as a short name for :class:`pyspark.sql.types.IntegerType`.\n    samplingRatio : float, optional\n        the sample ratio of rows used for inferring\n    verifySchema : bool, optional\n        verify data types of every row against schema. Enabled by default.\n    \n    Returns\n    -------\n    :class:`DataFrame`\n    \n    Notes\n    -----\n    Usage with spark.sql.execution.arrow.pyspark.enabled=True is experimental.\n    \n    Examples\n    --------\n    &gt;&gt;&gt; l = [(&#39;Alice&#39;, 1)]\n    &gt;&gt;&gt; spark.createDataFrame(l).collect()\n    [Row(_1=&#39;Alice&#39;, _2=1)]\n    &gt;&gt;&gt; spark.createDataFrame(l, [&#39;name&#39;, &#39;age&#39;]).collect()\n    [Row(name=&#39;Alice&#39;, age=1)]\n    \n    &gt;&gt;&gt; d = [{&#39;name&#39;: &#39;Alice&#39;, &#39;age&#39;: 1}]\n    &gt;&gt;&gt; spark.createDataFrame(d).collect()\n    [Row(age=1, name=&#39;Alice&#39;)]\n    \n    &gt;&gt;&gt; rdd = sc.parallelize(l)\n    &gt;&gt;&gt; spark.createDataFrame(rdd).collect()\n    [Row(_1=&#39;Alice&#39;, _2=1)]\n    &gt;&gt;&gt; df = spark.createDataFrame(rdd, [&#39;name&#39;, &#39;age&#39;])\n    &gt;&gt;&gt; df.collect()\n    [Row(name=&#39;Alice&#39;, age=1)]\n    \n    &gt;&gt;&gt; from pyspark.sql import Row\n    &gt;&gt;&gt; Person = Row(&#39;name&#39;, &#39;age&#39;)\n    &gt;&gt;&gt; person = rdd.map(lambda r: Person(*r))\n    &gt;&gt;&gt; df2 = spark.createDataFrame(person)\n    &gt;&gt;&gt; df2.collect()\n    [Row(name=&#39;Alice&#39;, age=1)]\n    \n    &gt;&gt;&gt; from pyspark.sql.types import *\n    &gt;&gt;&gt; schema = StructType([\n    ...    StructField(&#34;name&#34;, StringType(), True),\n    ...    StructField(&#34;age&#34;, IntegerType(), True)])\n    &gt;&gt;&gt; df3 = spark.createDataFrame(rdd, schema)\n    &gt;&gt;&gt; df3.collect()\n    [Row(name=&#39;Alice&#39;, age=1)]\n    \n    &gt;&gt;&gt; spark.createDataFrame(df.toPandas()).collect()  # doctest: +SKIP\n    [Row(name=&#39;Alice&#39;, age=1)]\n    &gt;&gt;&gt; spark.createDataFrame(pandas.DataFrame([[1, 2]])).collect()  # doctest: +SKIP\n    [Row(0=1, 1=2)]\n    \n    &gt;&gt;&gt; spark.createDataFrame(rdd, &#34;a: string, b: int&#34;).collect()\n    [Row(a=&#39;Alice&#39;, b=1)]\n    &gt;&gt;&gt; rdd = rdd.map(lambda row: row[1])\n    &gt;&gt;&gt; spark.createDataFrame(rdd, &#34;int&#34;).collect()\n    [Row(value=1)]\n    &gt;&gt;&gt; spark.createDataFrame(rdd, &#34;boolean&#34;).collect() # doctest: +IGNORE_EXCEPTION_DETAIL\n    Traceback (most recent call last):\n        ...\n    Py4JJavaError: ...\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1640448399145,"submitTime":1640448399138,"finishTime":1640448399160,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"6cd63542-4a8e-4d50-9b69-be4b772932bd"},{"version":"CommandV1","origId":1575837098435688,"guid":"a420b34e-1069-435b-8ffe-7edc7affb052","subtype":"command","commandType":"auto","position":2.0,"command":"spark.createDataFrame(users, schema=users_schema)","commandVersion":9,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Out[15]: DataFrame[id: int, first_name: string, last_name: string, email: string, is_customer: boolean, amount_paid: float, customer_from: date, last_updated_ts: timestamp]</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1640448399645,"submitTime":1640448399640,"finishTime":1640448399734,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"9551596f-89ab-4c2a-b5a7-dc5653074a49"},{"version":"CommandV1","origId":1575837098435689,"guid":"679159dd-21f0-4b19-b431-96c7ca2f93fa","subtype":"command","commandType":"auto","position":3.0,"command":"spark.createDataFrame(users, schema=users_schema).show()","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+---+----------+------------+--------------------+-----------+-----------+-------------+-------------------+\n| id|first_name|   last_name|               email|is_customer|amount_paid|customer_from|    last_updated_ts|\n+---+----------+------------+--------------------+-----------+-----------+-------------+-------------------+\n|  1|    Corrie|Van den Oord|cvandenoord0@etsy...|       true|    1000.55|   2021-01-15|2021-02-10 01:15:00|\n|  2|  Nikolaus|     Brewitt|nbrewitt1@dailyma...|       true|      900.0|   2021-02-14|2021-02-18 03:33:00|\n|  3|    Orelie|      Penney|openney2@vistapri...|       true|     850.55|   2021-01-21|2021-03-15 15:16:55|\n|  4|     Ashby|    Maddocks|  amaddocks3@home.pl|      false|       null|         null|2021-04-10 17:45:30|\n|  5|      Kurt|        Rome|krome4@shutterfly...|      false|       null|         null|2021-04-02 00:55:18|\n+---+----------+------------+--------------------+-----------+-----------+-------------+-------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1640448400840,"submitTime":1640448400837,"finishTime":1640448401129,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"a9c36b6d-82fb-4420-bc4f-f543623ca8b1"},{"version":"CommandV1","origId":1575837098435690,"guid":"f5fe4e56-db87-4d6d-beb7-cc6610d1ec40","subtype":"command","commandType":"auto","position":5.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"df70e88c-28ed-4676-9d4c-d0422831acd7"}],"dashboards":[],"guid":"da485490-62af-415e-9bd2-a74794dc7d4e","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4}}
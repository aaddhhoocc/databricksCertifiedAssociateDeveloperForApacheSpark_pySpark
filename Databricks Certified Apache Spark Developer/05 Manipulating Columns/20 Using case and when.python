{"version":"NotebookV1","origId":1575837098435393,"name":"20 Using case and when","language":"python","commands":[{"version":"CommandV1","origId":1575837098435394,"guid":"33e81cf9-2dc3-4dd0-b8f0-8646f7ec9f3f","subtype":"command","commandType":"auto","position":1.0,"command":"%md\n## Using CASE and WHEN\n\nLet us understand how to perform conditional operations using `CASE` and `WHEN` in Spark.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"364a2a7c-cf1b-49a8-8669-de496c942c99"},{"version":"CommandV1","origId":1575837098435395,"guid":"c8192be1-8ae1-442b-ad2b-7230c996fee3","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n* `CASE` and `WHEN` is typically used to apply transformations based up on conditions. We can use `CASE` and `WHEN` similar to SQL using `expr` or `selectExpr`.\n* If we want to use APIs, Spark provides functions such as `when` and `otherwise`. `when` is available as part of `pyspark.sql.functions`. On top of column type that is generated using `when` we should be able to invoke `otherwise`.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"91c4070a-9131-4b49-b677-d1b03c3c1739"},{"version":"CommandV1","origId":1575837098435396,"guid":"95b3ee7d-70c4-4a85-af3c-f4cf29cc56ca","subtype":"command","commandType":"auto","position":7.0,"command":"employees = [(1, \"Scott\", \"Tiger\", 1000.0, 10,\n                      \"united states\", \"+1 123 456 7890\", \"123 45 6789\"\n                     ),\n                     (2, \"Henry\", \"Ford\", 1250.0, None,\n                      \"India\", \"+91 234 567 8901\", \"456 78 9123\"\n                     ),\n                     (3, \"Nick\", \"Junior\", 750.0, '',\n                      \"united KINGDOM\", \"+44 111 111 1111\", \"222 33 4444\"\n                     ),\n                     (4, \"Bill\", \"Gomes\", 1500.0, 10,\n                      \"AUSTRALIA\", \"+61 987 654 3210\", \"789 12 6118\"\n                     )\n                ]","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160255197,"submitTime":1641160250257,"finishTime":1641160255278,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"c81edfa0-8c3e-43e3-85ae-0deadd669b4d"},{"version":"CommandV1","origId":1575837098435397,"guid":"9d99d542-aa2d-4a29-b277-ef2f703fdb42","subtype":"command","commandType":"auto","position":8.0,"command":"employeesDF = spark. \\\n    createDataFrame(employees,\n                    schema=\"\"\"employee_id INT, first_name STRING, \n                    last_name STRING, salary FLOAT, bonus STRING, nationality STRING,\n                    phone_number STRING, ssn STRING\"\"\"\n                   )","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"employeesDF","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"employee_id","nullable":true,"type":"integer"},{"metadata":{},"name":"first_name","nullable":true,"type":"string"},{"metadata":{},"name":"last_name","nullable":true,"type":"string"},{"metadata":{},"name":"salary","nullable":true,"type":"float"},{"metadata":{},"name":"bonus","nullable":true,"type":"string"},{"metadata":{},"name":"nationality","nullable":true,"type":"string"},{"metadata":{},"name":"phone_number","nullable":true,"type":"string"},{"metadata":{},"name":"ssn","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160255288,"submitTime":1641160250811,"finishTime":1641160260274,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"127e7ccc-7aee-4623-ae12-87e54bb15884"},{"version":"CommandV1","origId":1575837098435398,"guid":"9a562296-82ee-4571-a55d-90f7dae8bccb","subtype":"command","commandType":"auto","position":9.0,"command":"employeesDF.show()","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+-----------+----------+---------+------+-----+--------------+----------------+-----------+\n|employee_id|first_name|last_name|salary|bonus|   nationality|    phone_number|        ssn|\n+-----------+----------+---------+------+-----+--------------+----------------+-----------+\n|          1|     Scott|    Tiger|1000.0|   10| united states| +1 123 456 7890|123 45 6789|\n|          2|     Henry|     Ford|1250.0| null|         India|+91 234 567 8901|456 78 9123|\n|          3|      Nick|   Junior| 750.0|     |united KINGDOM|+44 111 111 1111|222 33 4444|\n|          4|      Bill|    Gomes|1500.0|   10|     AUSTRALIA|+61 987 654 3210|789 12 6118|\n+-----------+----------+---------+------+-----+--------------+----------------+-----------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160260285,"submitTime":1641160251565,"finishTime":1641160266569,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"efa7438f-dd1e-4845-bbc2-e2d63b1304d6"},{"version":"CommandV1","origId":1575837098435399,"guid":"5fc363bb-a116-4a9d-b86b-4bcec51a875c","subtype":"command","commandType":"auto","position":10.0,"command":"%md\n* Let us transform bonus to 0 in case of null or empty, otherwise return the bonus amount.","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"d89470c2-0891-4747-8311-05743e2657e0"},{"version":"CommandV1","origId":1575837098435400,"guid":"f3fa4ef8-ea3e-4d44-b688-640b5445ad9d","subtype":"command","commandType":"auto","position":11.0,"command":"from pyspark.sql.functions import coalesce, lit, col","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160266574,"submitTime":1641160253118,"finishTime":1641160266597,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"4296c2df-09ef-4626-a6be-0ba08866b567"},{"version":"CommandV1","origId":1575837098435401,"guid":"ea8345a4-00e9-45da-9509-3d2c31757cf0","subtype":"command","commandType":"auto","position":12.0,"command":"employeesDF. \\\n    withColumn('bonus1', coalesce(col('bonus').cast('int'), lit(0))). \\\n    show()","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+-----------+----------+---------+------+-----+--------------+----------------+-----------+------+\n|employee_id|first_name|last_name|salary|bonus|   nationality|    phone_number|        ssn|bonus1|\n+-----------+----------+---------+------+-----+--------------+----------------+-----------+------+\n|          1|     Scott|    Tiger|1000.0|   10| united states| +1 123 456 7890|123 45 6789|    10|\n|          2|     Henry|     Ford|1250.0| null|         India|+91 234 567 8901|456 78 9123|     0|\n|          3|      Nick|   Junior| 750.0|     |united KINGDOM|+44 111 111 1111|222 33 4444|     0|\n|          4|      Bill|    Gomes|1500.0|   10|     AUSTRALIA|+61 987 654 3210|789 12 6118|    10|\n+-----------+----------+---------+------+-----+--------------+----------------+-----------+------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160266602,"submitTime":1641160253816,"finishTime":1641160267005,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"c1dbbf66-2771-4f87-920c-e8e3d144f99a"},{"version":"CommandV1","origId":1575837098435402,"guid":"ae5d2bf5-c2e3-431b-8408-d59fd949d1d0","subtype":"command","commandType":"auto","position":13.0,"command":"from pyspark.sql.functions import expr","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160267010,"submitTime":1641160254837,"finishTime":1641160267027,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"2b9272bd-2215-4825-84b9-9ccc56f795b4"},{"version":"CommandV1","origId":1575837098435403,"guid":"6f0a8aea-d1c6-4840-902b-67646978a085","subtype":"command","commandType":"auto","position":14.0,"command":"employeesDF. \\\n    withColumn(\n        'bonus', \n        expr(\"\"\"\n            CASE WHEN bonus IS NULL OR bonus = '' THEN 0\n            ELSE bonus\n            END\n            \"\"\")\n    ). \\\n    show()","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+-----------+----------+---------+------+-----+--------------+----------------+-----------+\n|employee_id|first_name|last_name|salary|bonus|   nationality|    phone_number|        ssn|\n+-----------+----------+---------+------+-----+--------------+----------------+-----------+\n|          1|     Scott|    Tiger|1000.0|   10| united states| +1 123 456 7890|123 45 6789|\n|          2|     Henry|     Ford|1250.0|    0|         India|+91 234 567 8901|456 78 9123|\n|          3|      Nick|   Junior| 750.0|    0|united KINGDOM|+44 111 111 1111|222 33 4444|\n|          4|      Bill|    Gomes|1500.0|   10|     AUSTRALIA|+61 987 654 3210|789 12 6118|\n+-----------+----------+---------+------+-----+--------------+----------------+-----------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160267032,"submitTime":1641160255350,"finishTime":1641160268024,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"193943e8-d795-471d-adaa-09b6fd2a8285"},{"version":"CommandV1","origId":1575837098435404,"guid":"2f2583d8-f607-4e40-9851-da3f3ab399d3","subtype":"command","commandType":"auto","position":15.0,"command":"from pyspark.sql.functions import when","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160268033,"submitTime":1641160256111,"finishTime":1641160268052,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"ca7ced87-a105-48f2-82c7-52d9f4cfd088"},{"version":"CommandV1","origId":1575837098435405,"guid":"9db15233-344b-4a94-952a-10682a3e4f6d","subtype":"command","commandType":"auto","position":16.0,"command":"when?","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansi-red-fg\">Signature:</span> when<span class=\"ansi-blue-fg\">(</span>condition<span class=\"ansi-blue-fg\">,</span> value<span class=\"ansi-blue-fg\">)</span>\n<span class=\"ansi-red-fg\">Docstring:</span>\nEvaluates a list of conditions and returns one of multiple possible result expressions.\nIf :func:`pyspark.sql.Column.otherwise` is not invoked, None is returned for unmatched\nconditions.\n\n.. versionadded:: 1.4.0\n\nParameters\n----------\ncondition : :class:`~pyspark.sql.Column`\n    a boolean :class:`~pyspark.sql.Column` expression.\nvalue :\n    a literal value, or a :class:`~pyspark.sql.Column` expression.\n\n&gt;&gt;&gt; df.select(when(df[&#39;age&#39;] == 2, 3).otherwise(4).alias(&#34;age&#34;)).collect()\n[Row(age=3), Row(age=4)]\n\n&gt;&gt;&gt; df.select(when(df.age == 2, df.age + 1).alias(&#34;age&#34;)).collect()\n[Row(age=3), Row(age=None)]\n<span class=\"ansi-red-fg\">File:</span>      /databricks/spark/python/pyspark/sql/functions.py\n<span class=\"ansi-red-fg\">Type:</span>      function\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160268058,"submitTime":1641160256694,"finishTime":1641160268152,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"028a0207-22f6-45da-8283-2e97586039da"},{"version":"CommandV1","origId":1575837098435406,"guid":"d9650050-9c0e-49bb-a058-816a8f58593a","subtype":"command","commandType":"auto","position":17.0,"command":"employeesDF. \\\n    withColumn(\n        'bonus',\n        when((col('bonus').isNull()) | (col('bonus') == lit('')), 0).otherwise(col('bonus'))\n    ). \\\n    show()","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+-----------+----------+---------+------+-----+--------------+----------------+-----------+\n|employee_id|first_name|last_name|salary|bonus|   nationality|    phone_number|        ssn|\n+-----------+----------+---------+------+-----+--------------+----------------+-----------+\n|          1|     Scott|    Tiger|1000.0|   10| united states| +1 123 456 7890|123 45 6789|\n|          2|     Henry|     Ford|1250.0|    0|         India|+91 234 567 8901|456 78 9123|\n|          3|      Nick|   Junior| 750.0|    0|united KINGDOM|+44 111 111 1111|222 33 4444|\n|          4|      Bill|    Gomes|1500.0|   10|     AUSTRALIA|+61 987 654 3210|789 12 6118|\n+-----------+----------+---------+------+-----+--------------+----------------+-----------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160268164,"submitTime":1641160257576,"finishTime":1641160270406,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"8934b6c3-a774-4ef2-93aa-6b1d849d1b9d"},{"version":"CommandV1","origId":1575837098435407,"guid":"e691b26b-4eec-4079-86ea-5d7035a204d5","subtype":"command","commandType":"auto","position":18.0,"command":"%md\n* Create a dataframe using list called as persons and categorize them based up on following rules.\n\n|Age range|Category|\n|---------|--------|\n|0 to 2 Months|New Born|\n|2+ Months to 12 Months|Infant|\n|12+ Months to 48 Months|Toddler|\n|48+ Months to 144 Months|Kids|\n|144+ Months|Teenager or Adult|","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"f2a64485-e675-487c-b93d-43c2cd829bef"},{"version":"CommandV1","origId":1575837098435408,"guid":"a6b00589-f893-4a48-893b-60e88a26c920","subtype":"command","commandType":"auto","position":19.0,"command":"persons = [\n    (1, 1),\n    (2, 13),\n    (3, 18),\n    (4, 60),\n    (5, 120),\n    (6, 0),\n    (7, 12),\n    (8, 160)\n]","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160270424,"submitTime":1641160258531,"finishTime":1641160270440,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"4d397b53-c890-4ef9-8baa-d2637897a38e"},{"version":"CommandV1","origId":1575837098435409,"guid":"447c6e63-adde-4c27-b0f8-a19a003a79e0","subtype":"command","commandType":"auto","position":20.0,"command":"personsDF = spark.createDataFrame(persons, schema='id INT, age INT')","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"personsDF","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"id","nullable":true,"type":"integer"},{"metadata":{},"name":"age","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160270450,"submitTime":1641160259340,"finishTime":1641160270554,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"cf7648ac-65c0-4507-b07c-8a16bd1c38fd"},{"version":"CommandV1","origId":1575837098435410,"guid":"16a9a7d1-fbaf-469b-acb8-4e352dfae08b","subtype":"command","commandType":"auto","position":21.0,"command":"personsDF.show()","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+---+---+\n| id|age|\n+---+---+\n|  1|  1|\n|  2| 13|\n|  3| 18|\n|  4| 60|\n|  5|120|\n|  6|  0|\n|  7| 12|\n|  8|160|\n+---+---+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160270560,"submitTime":1641160260004,"finishTime":1641160270752,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"6e6a3e23-1328-47fd-a83c-f210df013c5b"},{"version":"CommandV1","origId":1575837098435411,"guid":"7a61e3b1-3f2d-4ba7-9f58-8469944fec5c","subtype":"command","commandType":"auto","position":22.0,"command":"personsDF. \\\n    withColumn(\n        'category',\n        expr(\"\"\"\n            CASE\n            WHEN age BETWEEN 0 AND 2 THEN 'New Born'\n            WHEN age > 2 AND age <= 12 THEN 'Infant'\n            WHEN age > 12 AND age <= 48 THEN 'Toddler'\n            WHEN age > 48 AND age <= 144 THEN 'Kid'\n            ELSE 'Teenager or Adult'\n            END\n        \"\"\")\n    ). \\\n    show()","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+---+---+-----------------+\n| id|age|         category|\n+---+---+-----------------+\n|  1|  1|         New Born|\n|  2| 13|          Toddler|\n|  3| 18|          Toddler|\n|  4| 60|              Kid|\n|  5|120|              Kid|\n|  6|  0|         New Born|\n|  7| 12|           Infant|\n|  8|160|Teenager or Adult|\n+---+---+-----------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160270762,"submitTime":1641160261009,"finishTime":1641160271073,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"d09906c8-60ce-4df8-bb26-f4d7d1ef3ba3"},{"version":"CommandV1","origId":1575837098435412,"guid":"0c1837d2-f6d2-4252-9b70-925b80f1c243","subtype":"command","commandType":"auto","position":23.0,"command":"personsDF. \\\n    withColumn(\n        'category',\n        when(col('age').between(0, 2), 'New Born').\n        when((col('age') > 2) & (col('age') <= 12), 'Infant').\n        when((col('age') > 12) & (col('age') <= 48), 'Toddler').\n        when((col('age') > 48) & (col('age') <= 144), 'Kid').\n        otherwise('Teenager or Adult')\n    ). \\\n    show()","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+---+---+-----------------+\n| id|age|         category|\n+---+---+-----------------+\n|  1|  1|         New Born|\n|  2| 13|          Toddler|\n|  3| 18|          Toddler|\n|  4| 60|              Kid|\n|  5|120|              Kid|\n|  6|  0|         New Born|\n|  7| 12|           Infant|\n|  8|160|Teenager or Adult|\n+---+---+-----------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641160271079,"submitTime":1641160261685,"finishTime":1641160271561,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"1053425d-11aa-48bb-92d3-c1dd6671d23c"},{"version":"CommandV1","origId":1575837098435413,"guid":"44022891-597b-464f-a274-1c1d9b08c074","subtype":"command","commandType":"auto","position":24.0,"command":"","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"71f9e2d1-2f71-4fff-a545-0331947f4393"}],"dashboards":[],"guid":"df571f52-787c-42f9-9e97-f48e41add557","globalVars":{},"iPythonMetadata":{"nbformat":4,"IPythonMetadata":{"kernelspec":{"display_name":"Pyspark 2","language":"python","name":"pyspark2"},"language_info":{"mimetype":"text/x-python","name":"python","pygments_lexer":"ipython3","codemirror_mode":{"name":"ipython","version":3},"version":"3.6.12","nbconvert_exporter":"python","file_extension":".py"}}},"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4}}
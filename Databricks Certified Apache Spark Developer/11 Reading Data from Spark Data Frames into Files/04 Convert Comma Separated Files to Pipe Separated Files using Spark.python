{"version":"NotebookV1","origId":1575837098434974,"name":"04 Convert Comma Separated Files to Pipe Separated Files using Spark","language":"python","commands":[{"version":"CommandV1","origId":1575837098434975,"guid":"579a3bc1-ad43-45b7-be4c-87c6f98440ee","subtype":"command","commandType":"auto","position":16.0,"command":"# Copy all the data with comma separator to pipe separator\n\nimport getpass\nusername = getpass.getuser()\n\ninput_dir = '/public/retail_db'\noutput_dir = f'/user/{username}/retail_db_pipe'","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641510315432,"submitTime":1641510313612,"finishTime":1641510315466,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"21b6b8be-cdfc-4193-92e8-cc6e7f6500b6"},{"version":"CommandV1","origId":1575837098434976,"guid":"48d66e6e-84af-4de0-bb29-4cdcce8fd290","subtype":"command","commandType":"auto","position":16.5,"command":"dbutils.fs.ls('/public/retail_db')","commandVersion":9,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Out[2]: [FileInfo(path=&#39;dbfs:/public/retail_db/categories/&#39;, name=&#39;categories/&#39;, size=0),\n FileInfo(path=&#39;dbfs:/public/retail_db/customers/&#39;, name=&#39;customers/&#39;, size=0),\n FileInfo(path=&#39;dbfs:/public/retail_db/departments/&#39;, name=&#39;departments/&#39;, size=0),\n FileInfo(path=&#39;dbfs:/public/retail_db/order_items/&#39;, name=&#39;order_items/&#39;, size=0),\n FileInfo(path=&#39;dbfs:/public/retail_db/orders/&#39;, name=&#39;orders/&#39;, size=0),\n FileInfo(path=&#39;dbfs:/public/retail_db/products/&#39;, name=&#39;products/&#39;, size=0)]</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641510315472,"submitTime":1641510314009,"finishTime":1641510315553,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"d17c41e9-1b1e-46c0-8fa8-14346225c8b6"},{"version":"CommandV1","origId":1575837098434977,"guid":"e5b4c6be-5e38-4471-bc6b-c24bd4aed833","subtype":"command","commandType":"auto","position":17.0,"command":"# Generate CSV files with pipe delimiter\nfor file_details in dbutils.fs.ls(input_dir):\n    if 'git' not in file_details.path and 'sql' not in file_details.path:\n        print(f'Converting data in {file_details.path} folder from comma separated to pipe separated')\n        df = spark.read.csv(file_details.path)\n        folder_name = file_details.path.split('/')[-2]\n        df.coalesce(1).write.mode('overwrite').csv(f'{output_dir}/{folder_name}', sep='|')","commandVersion":13,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Converting data in dbfs:/public/retail_db/categories/ folder from comma separated to pipe separated\nConverting data in dbfs:/public/retail_db/customers/ folder from comma separated to pipe separated\nConverting data in dbfs:/public/retail_db/departments/ folder from comma separated to pipe separated\nConverting data in dbfs:/public/retail_db/order_items/ folder from comma separated to pipe separated\nConverting data in dbfs:/public/retail_db/orders/ folder from comma separated to pipe separated\nConverting data in dbfs:/public/retail_db/products/ folder from comma separated to pipe separated\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"_c0","nullable":true,"type":"string"},{"metadata":{},"name":"_c1","nullable":true,"type":"string"},{"metadata":{},"name":"_c2","nullable":true,"type":"string"},{"metadata":{},"name":"_c3","nullable":true,"type":"string"},{"metadata":{},"name":"_c4","nullable":true,"type":"string"},{"metadata":{},"name":"_c5","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641510315565,"submitTime":1641510314363,"finishTime":1641510325959,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"4fdf6e41-a2f2-4904-95fb-f32fb295ed18"},{"version":"CommandV1","origId":1575837098434978,"guid":"105d47d7-4790-4de4-b258-54532350eae0","subtype":"command","commandType":"auto","position":18.0,"command":"schema = \"\"\"\n    order_id INT,\n    order_date TIMESTAMP,\n    order_customer_id INT,\n    order_status STRING\n\"\"\"","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641510325965,"submitTime":1641510314886,"finishTime":1641510325979,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"5c21cf47-476f-453f-b2c6-2c071f8a4740"},{"version":"CommandV1","origId":1575837098434979,"guid":"2598375b-eb7b-4b45-8f83-6fcdc696a19e","subtype":"command","commandType":"auto","position":19.0,"command":"orders = spark.read.schema(schema).csv(f'/user/{username}/retail_db_pipe/orders')","commandVersion":20,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"orders","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"order_id","nullable":true,"type":"integer"},{"metadata":{},"name":"order_date","nullable":true,"type":"timestamp"},{"metadata":{},"name":"order_customer_id","nullable":true,"type":"integer"},{"metadata":{},"name":"order_status","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641510325985,"submitTime":1641510315415,"finishTime":1641510326191,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"d4285bd2-7597-47eb-8d9c-3a5d0884632a"},{"version":"CommandV1","origId":1575837098434980,"guid":"f6e4e413-97cc-4d71-b00b-675fd327d380","subtype":"command","commandType":"auto","position":20.0,"command":"orders.show()","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+--------+----------+-----------------+------------+\n|order_id|order_date|order_customer_id|order_status|\n+--------+----------+-----------------+------------+\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n|    null|      null|             null|        null|\n+--------+----------+-----------------+------------+\nonly showing top 20 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641510326202,"submitTime":1641510316019,"finishTime":1641510326576,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"812b698d-ac7d-4ede-a264-0460d8e7fb40"},{"version":"CommandV1","origId":1575837098434981,"guid":"04cd166b-8091-4dc6-98c3-af74d1553373","subtype":"command","commandType":"auto","position":21.0,"command":"orders = spark.read.schema(schema).csv(f'/user/{username}/retail_db_pipe/orders', sep='|')","commandVersion":4,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"orders","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"order_id","nullable":true,"type":"integer"},{"metadata":{},"name":"order_date","nullable":true,"type":"timestamp"},{"metadata":{},"name":"order_customer_id","nullable":true,"type":"integer"},{"metadata":{},"name":"order_status","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641510326582,"submitTime":1641510317201,"finishTime":1641510326770,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"794cbf93-da6b-4b14-9f9f-07beada78375"},{"version":"CommandV1","origId":1575837098434982,"guid":"a8cf3f78-5458-47dc-81d9-31f65af1eb5c","subtype":"command","commandType":"auto","position":22.0,"command":"orders.show()","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">+--------+-------------------+-----------------+---------------+\n|order_id|         order_date|order_customer_id|   order_status|\n+--------+-------------------+-----------------+---------------+\n|       1|2013-07-25 00:00:00|            11599|         CLOSED|\n|       2|2013-07-25 00:00:00|              256|PENDING_PAYMENT|\n|       3|2013-07-25 00:00:00|            12111|       COMPLETE|\n|       4|2013-07-25 00:00:00|             8827|         CLOSED|\n|       5|2013-07-25 00:00:00|            11318|       COMPLETE|\n|       6|2013-07-25 00:00:00|             7130|       COMPLETE|\n|       7|2013-07-25 00:00:00|             4530|       COMPLETE|\n|       8|2013-07-25 00:00:00|             2911|     PROCESSING|\n|       9|2013-07-25 00:00:00|             5657|PENDING_PAYMENT|\n|      10|2013-07-25 00:00:00|             5648|PENDING_PAYMENT|\n|      11|2013-07-25 00:00:00|              918| PAYMENT_REVIEW|\n|      12|2013-07-25 00:00:00|             1837|         CLOSED|\n|      13|2013-07-25 00:00:00|             9149|PENDING_PAYMENT|\n|      14|2013-07-25 00:00:00|             9842|     PROCESSING|\n|      15|2013-07-25 00:00:00|             2568|       COMPLETE|\n|      16|2013-07-25 00:00:00|             7276|PENDING_PAYMENT|\n|      17|2013-07-25 00:00:00|             2667|       COMPLETE|\n|      18|2013-07-25 00:00:00|             1205|         CLOSED|\n|      19|2013-07-25 00:00:00|             9488|PENDING_PAYMENT|\n|      20|2013-07-25 00:00:00|             9198|     PROCESSING|\n+--------+-------------------+-----------------+---------------+\nonly showing top 20 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1641510326775,"submitTime":1641510319009,"finishTime":1641510326946,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"96553a72-77cf-48dd-9ff1-3746865e3326"},{"version":"CommandV1","origId":1575837098434983,"guid":"8bf14d8d-286d-4412-997c-382673d57180","subtype":"command","commandType":"auto","position":23.0,"command":"","commandVersion":0,"state":"error","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultSubCmdIds":[],"tableResultIndex":null,"nuid":"8594e109-faea-4609-81cf-9b2ff09c14d9"}],"dashboards":[],"guid":"011f68a3-88b8-4ff0-854a-ac8a90d11217","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4}}